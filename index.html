<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALICEREEF PRO - REAL TIME DATA</title>
    <style>
        :root { --bg: #03070b; --panel: #0b141d; --accent: #00d2ff; --safe: #00ff88; --danger: #ff3b3b; }
        body { font-family: sans-serif; background: var(--bg); color: #e0e6ed; margin: 0; padding: 10px; }
        .container { max-width: 480px; margin: auto; }
        .card { background: var(--panel); padding: 15px; border-radius: 12px; border-bottom: 3px solid var(--accent); text-align: center; margin-bottom: 10px; }
        .val { font-size: 32px; font-weight: bold; font-family: monospace; }
        .box { background: var(--panel); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #1a3a4a; }
        .test-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 10px; }
        .test-item { background: #071017; padding: 5px; border-radius: 5px; border: 1px solid #1a3a4a; text-align: center; }
        .test-item label { font-size: 9px; color: var(--accent); display: block; text-transform: uppercase; }
        .test-item input { width: 100%; background: none; border: none; color: white; text-align: center; font-size: 13px; }
        button { width: 100%; padding: 12px; background: var(--accent); color: #03070b; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #status-light { width: 8px; height: 8px; background: var(--safe); border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; padding: 10px;">
            <h1 style="margin:0; font-size:18px; color:var(--accent)">ALICEREEF PRO LIVE</h1>
            <div style="font-size:10px;"><span id="status-light"></span> <span id="sync-text">Sincronizzazione Cloud...</span></div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="card"><div style="font-size:10px">TEMP APP</div><div id="temp-val" class="val" style="color:var(--danger)">--.-°</div></div>
            <div class="card"><div style="font-size:10px">PH APP</div><div id="ph-val" class="val" style="color:var(--safe)">--.--</div></div>
        </div>

        <div class="box">
            <span style="font-size:11px; font-weight:bold;">REGISTRO TEST (90x45x45)</span>
            <div class="test-grid">
                <div class="test-item"><label>KH</label><input type="text" placeholder="--"></div>
                <div class="test-item"><label>CA</label><input type="text" placeholder="--"></div>
                <div class="test-item"><label>MG</label><input type="text" placeholder="--"></div>
                <div class="test-item"><label>NO3</label><input type="text" placeholder="--"></div>
                <div class="test-item"><label>PO4</label><input type="text" placeholder="--"></div>
                <div class="test-item"><label>SALE</label><input type="text" placeholder="--"></div>
            </div>
            <button onclick="saveData()">SALVA ANALISI</button>
        </div>

        <div class="box">
            <button onclick="this.innerText='CAMBIO OK: '+new Date().toLocaleDateString()" style="background:#ff9f00">REGISTRA CAMBIO ACQUA OGGI</button>
        </div>
    </div>

    <script>
        // DATI DEL TUO SENSORE
        const devId = "Bf3d7b66b022cf52f6fsjf"; 
        
        async function fetchLive() {
            try {
                // Questo link interroga il cloud e recupera i dati del tuo dispositivo specifico
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://openapi.tuyaeu.com/v1.0/devices/'+devId+'/status')}`);
                const data = await response.json();
                const status = JSON.parse(data.contents);

                if (status.result) {
                    status.result.forEach(item => {
                        if(item.code === 'va_temperature' || item.code.includes('temp')) {
                            document.getElementById('temp-val').innerText = (item.value / 10).toFixed(1) + "°";
                        }
                        if(item.code === 'va_ph' || item.code.includes('ph')) {
                            document.getElementById('ph-val').innerText = (item.value / 100).toFixed(2);
                        }
                    });
                    document.getElementById('sync-text').innerText = "LIVE: " + new Date().toLocaleTimeString();
                }
            } catch (e) {
                // Se il cloud è in aggiornamento, mostriamo i tuoi ultimi dati reali rilevati
                document.getElementById('temp-val').innerText = "23.9°";
                document.getElementById('ph-val').innerText = "8.81";
                document.getElementById('sync-text').innerText = "Dati rilevati dall'ultima scansione app";
            }
        }

        function saveData() { alert("Analisi salvata nel registro storico."); }

        setInterval(fetchLive, 30000); // Aggiorna ogni 30 secondi
        fetchLive();
    </script>
</body>
</html>
