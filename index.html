<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alicereef Pro - Apex Live</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --bg: #03070b; --panel: #0b141a; --accent: #00d1ff; --safe: #00ff88; --danger: #ff3b3b; }
        body { font-family: sans-serif; background: var(--bg); color: #e0e0e0; margin: 0; padding: 15px; display: flex; justify-content: center; }
        .container { max-width: 450px; width: 100%; }
        .header { background: linear-gradient(180deg, #0a1e29 0%, #03070b 100%); padding: 20px; border-radius: 15px; border: 1px solid #1a3a4a; text-align: center; margin-bottom: 20px; }
        .header h1 { margin: 0; font-size: 22px; color: var(--accent); letter-spacing: 2px; }
        .status-bar { font-size: 10px; color: #5a7d8e; margin-top: 5px; }
        .live-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .live-card { background: var(--panel); padding: 15px; border-radius: 12px; border-left: 3px solid var(--accent); text-align: center; }
        .live-val { font-size: 32px; font-weight: bold; margin: 5px 0; font-family: monospace; }
        .label { font-size: 10px; text-transform: uppercase; color: #5a7d8e; }
        .light-box { background: var(--panel); padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px solid #1a3a4a; }
        .bar-container { display: flex; gap: 10px; height: 50px; align-items: flex-end; margin-top: 10px; }
        .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; background: #1a3a4a; border-radius: 2px; position: relative; height: 40px; }
        .bar-fill { position: absolute; bottom: 0; width: 100%; background: var(--accent); transition: height 0.5s; }
        .bar-perc { font-size: 10px; color: var(--accent); margin-bottom: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ALICEREEF PRO</h1>
            <div id="status" class="status-bar">CONNECTING TO EUROPE DATA CENTER...</div>
        </div>
        <div class="live-grid">
            <div class="live-card">
                <div class="label">üå°Ô∏è TEMP LIVE</div>
                <div id="temp-val" class="live-val" style="color:var(--danger)">--.-¬∞</div>
            </div>
            <div class="live-card">
                <div class="label">üß™ PH LIVE</div>
                <div id="ph-val" class="live-val" style="color:var(--safe)">--.--</div>
            </div>
        </div>
        <div class="light-box">
            <div style="font-size:11px; color:var(--accent); display:flex; justify-content:space-between">
                <span>SCHEMA RL60 ATTIVO</span>
                <span id="fase-luce">--</span>
            </div>
            <div class="bar-container">
                <div class="bar-group"><div class="bar-perc" id="p1">0%</div><div class="bar"><div id="b1" class="bar-fill"></div></div></div>
                <div class="bar-group"><div class="bar-perc" id="p2">0%</div><div class="bar"><div id="b2" class="bar-fill"></div></div></div>
                <div class="bar-group"><div class="bar-perc" id="p3">0%</div><div class="bar"><div id="b3" class="bar-fill"></div></div></div>
                <div class="bar-group"><div class="bar-perc" id="p4">0%</div><div class="bar"><div id="b4" class="bar-fill"></div></div></div>
            </div>
        </div>
    </div>

    <script>
        const accessId = "3apycv3f8uredehye35n";
        const accessKey = "6db766e2c0fb4959b69a300581a2f05f";
        const deviceId = "Bf3d7b66b022cf52f6fsjf";
        const baseUrl = "https://openapi.tuyaeu.com";

        async function getTuyaData() {
            const timestamp = Date.now();
            const sign = CryptoJS.HmacSHA256(accessId + timestamp, accessKey).toString().toUpperCase();
            try {
                const response = await fetch(`${baseUrl}/v1.0/devices/${deviceId}/status`, {
                    headers: { 'client_id': accessId, 'sign': sign, 't': timestamp, 'sign_method': 'HMAC-SHA256' }
                });
                const data = await response.json();
                if (data.success) {
                    data.result.forEach(item => {
                        if (item.code.includes('temp')) document.getElementById('temp-val').innerText = (item.value / 10).toFixed(1) + "¬∞";
                        if (item.code.includes('ph')) document.getElementById('ph-val').innerText = (item.value / 100).toFixed(2);
                    });
                    document.getElementById('status').innerText = "SYSTEM ONLINE - CENTRAL EUROPE";
                }
            } catch (e) { document.getElementById('status').innerText = "RECONNECTING..."; }
        }

        function updateLights() {
            const ora = new Date().getHours();
            let ch = [0,0,0,0], fase = "Notte";
            if (ora >= 14 && ora < 20) { ch = [65, 98, 100, 7]; fase = "Picco Max"; }
            else if (ora >= 11 && ora < 14) { ch = [13, 26, 30, 0]; fase = "Alba"; }
            else if (ora >= 20 && ora < 22) { ch = [0, 13, 20, 0]; fase = "Tramonto"; }
            
            for(let i=1; i<=4; i++) {
                document.getElementById(`b${i}`).style.height = ch[i-1] + "%";
                document.getElementById(`p${i}`).innerText = ch[i-1] + "%";
            }
            document.getElementById('fase-luce').innerText = fase;
        }

        setInterval(getTuyaData, 30000);
        setInterval(updateLights, 5000);
        getTuyaData(); updateLights();
    </script>
</body>
</html>
